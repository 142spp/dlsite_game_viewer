<Window x:Class="DLGameViewer.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:local="clr-namespace:DLGameViewer"
        xmlns:utils="clr-namespace:DLGameViewer.Utils"
        mc:Ignorable="d"
        Title="DL Game Viewer" Height="1200" Width="1600"
        Icon="Resources/favicon.ico">
    <Window.Resources>
        <utils:PathToImageSourceConverter x:Key="PathToImageSourceConverterInstance"/>
    </Window.Resources>
    <Grid Margin="10">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/> <!-- Scan Controls Title -->
            <RowDefinition Height="Auto"/> <!-- Scan Folder Path & Buttons -->
            <RowDefinition Height="Auto"/> <!-- Results Title -->
            <RowDefinition Height="150"/>  <!-- Scan Results TextBox -->
            <RowDefinition Height="Auto"/> <!-- Game List Title -->
            <RowDefinition Height="*"/>   <!-- Game List ItemsControl -->
        </Grid.RowDefinitions>

        <!-- Scan Controls -->
        <TextBlock Grid.Row="0" Text="폴더 스캔" FontSize="20" FontWeight="Bold" Margin="0,0,0,10"/>
        <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,0,0,10">
            <TextBlock Text="스캔할 폴더 경로:" VerticalAlignment="Center" Margin="0,0,5,0"/>
            <TextBox x:Name="txtScanFolderPath" Width="350" Margin="0,0,5,0" IsReadOnly="True" VerticalAlignment="Center" Text="(선택된 폴더 없음)"/>
            <Button x:Name="btnBrowseFolder" Content="폴더 선택..." Width="100" Height="30" Click="btnBrowseFolder_Click" Margin="0,0,5,0" VerticalAlignment="Center"/>
            <Button x:Name="btnScanFolder" Content="폴더 스캔 시작" Width="120" Height="30" Click="btnScanFolder_Click" VerticalAlignment="Center" Margin="0,0,5,0"/>
            <Button x:Name="btnClearDatabase" Content="데이터베이스 초기화" Width="150" Height="30" Click="btnClearDatabase_Click" VerticalAlignment="Center" Background="#FFEEEE" Foreground="DarkRed"/>
        </StackPanel>

        <!-- Results -->
        <TextBlock Grid.Row="2" Text="스캔 결과:" FontWeight="Bold" Margin="0,10,0,5"/>
        <TextBox Grid.Row="3" x:Name="txtScanResults" TextWrapping="Wrap" VerticalScrollBarVisibility="Auto" IsReadOnly="True" Background="#FFEFEFEF" Padding="5"/>

        <!-- Game List -->
        <StackPanel Grid.Row="4" Orientation="Horizontal" Margin="0,10,0,5">
            <TextBlock Text="게임 목록:" FontSize="16" FontWeight="Bold" Margin="0,0,5,0"/>
            <Button x:Name="btnRefreshGameList" Content="새로고침" Width="120" Height="30" Click="btnRefreshGameList_Click" VerticalAlignment="Center"/>
        </StackPanel>
        <ScrollViewer Grid.Row="5" VerticalScrollBarVisibility="Auto" Margin="0,0,0,0">
            <ItemsControl x:Name="GamesItemsControl">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <WrapPanel Orientation="Horizontal" ItemWidth="240" ItemHeight="360"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Border BorderBrush="LightGray" BorderThickness="1" Margin="10" Padding="5,0,5,10" Height="320">
                            <Border.ContextMenu>
                                <ContextMenu>
                                    <MenuItem Header="게임 실행" Click="MenuItemRunGame_Click"/>
                                    <MenuItem Header="게임 정보 보기" Click="MenuItemGameInfo_Click"/>
                                    <Separator/>
                                    <MenuItem Header="폴더 열기" Click="MenuItemOpenFolder_Click"/>
                                    <Separator/>
                                    <MenuItem Header="데이터베이스에서 삭제" Click="MenuItemDeleteFromDb_Click" 
                                              Background="#FFEEEE" Foreground="DarkRed"/>
                                </ContextMenu>
                            </Border.ContextMenu>
                            
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="Background" Value="White"/>
                                    <Setter Property="Effect">
                                        <Setter.Value>
                                            <DropShadowEffect ShadowDepth="1" BlurRadius="5" Opacity="0.2" Color="Gray"/>
                                        </Setter.Value>
                                    </Setter>
                                    <Style.Triggers>
                                        <Trigger Property="IsMouseOver" Value="True">
                                            <Setter Property="Background" Value="#F5F5F5"/>
                                            <Setter Property="BorderBrush" Value="#AAAAAA"/>
                                            <Setter Property="Effect">
                                                <Setter.Value>
                                                    <DropShadowEffect ShadowDepth="2" BlurRadius="8" Opacity="0.3" Color="Gray"/>
                                                </Setter.Value>
                                            </Setter>
                                        </Trigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="180"/>
                                    <RowDefinition Height="80"/>
                                    <RowDefinition Height="*"/>
                                    <RowDefinition Height="35"/>
                                </Grid.RowDefinitions>
                                
                                <Grid Grid.Row="0" Width="200" Height="180">
                                    <Image x:Name="GameCoverImage"
                                           Stretch="Uniform"
                                           Source="{Binding CoverImagePath, Converter={StaticResource PathToImageSourceConverterInstance}, ConverterParameter='ListImageContent'}"/>
                                    <TextBlock Text="None"
                                               HorizontalAlignment="Center"
                                               VerticalAlignment="Center"
                                               FontSize="20"
                                               Foreground="DarkGray">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Setter Property="Visibility" Value="Collapsed"/>
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding Source, ElementName=GameCoverImage}" Value="{x:Null}">
                                                        <Setter Property="Visibility" Value="Visible"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Grid>
                                
                                <StackPanel Grid.Row="1" Orientation="Vertical">
                                    <TextBlock Text="{Binding Identifier}" FontWeight="SemiBold" FontSize="16" TextWrapping="Wrap" HorizontalAlignment="Center" TextAlignment="Center" Height="Auto" MaxHeight="20" VerticalAlignment="Top"/>
                                    <TextBlock Text="{Binding Title}"  FontSize="15" Margin="0,5,0,0" TextWrapping="Wrap" HorizontalAlignment="Center" TextAlignment="Center" Height="Auto" MaxHeight="80"/>
                                </StackPanel>
                                
                                <StackPanel Grid.Row="3" Orientation="Horizontal" HorizontalAlignment="Center">
                                    <Button Content="실행" Width="60" Height="30" Margin="0,0,10,0" Click="btnRunGame_Click" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                    <Button Content="게임 정보" Width="100" Height="30"  Click="btnGameInfo_Click" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </ScrollViewer>
    </Grid>
</Window>
